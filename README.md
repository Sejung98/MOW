# MOW 데스크톱 재무 관리 도구

로컬 SQLite 데이터베이스와 Tkinter GUI를 활용해 **재고·매출·세금·재무제표**를 자동화하는 데스크톱 애플리케이션입니다. 상품 정보 입력부터 세금계산서 생성, 월별 손익/대차/현금흐름 보고서 출력까지 모두 한 화면에서 처리할 수 있습니다.

## 주요 기능
- **재고 관리**: 상품 코드, 단가, 판매가, 재고 수량, 재주문 기준을 입력하고 입고/출고 내역을 자동 기록합니다.
- **매출 및 영업이익 계산**: 판매 등록 시 매출액·매출원가·매출총이익을 계산하고 CSV 세금계산서를 생성합니다.
- **세금 계산**: 부가가치세(기본 10%)와 소득세율을 실시간으로 조정하여 적용합니다.
- **재무제표 & 그래프**: 월별 손익계산서, 대차대조표, 현금흐름표를 화면에서 확인하거나 Excel 파일(xlsx)로 저장하고, 최근 12개월 매출·영업이익·세금 추이를 고급 라인 차트로 시각화합니다.
- **백업/복원**: SQLite 데이터베이스를 원하는 위치에 백업하고 기존 파일로 복원할 수 있습니다.
- **양방향 문서 동기화**: `sync/mow_sync.xlsx`와 `sync/mow_sync.tsv`를 자동으로 생성·갱신하며, 문서를 직접 수정 후 프로그램에서 불러와 DB에 반영할 수 있습니다.
- **디자인 커스터마이징**: `theme.json` 파일을 수정하여 글꼴, 색상, 강조색 등을 바꿀 수 있습니다.

## 실행 준비
1. Python 3.10 이상이 설치되어 있는지 확인합니다.
2. 프로젝트 루트에서 필요한 패키지를 설치합니다.
   ```bash
   pip install pandas openpyxl matplotlib
   ```
3. 애플리케이션을 실행합니다.
   ```bash
   python inventory_app.py
   ```
4. 첫 실행 시 `data/mow.db` 파일이 자동으로 생성되며, 모든 정보가 이 SQLite 데이터베이스에 저장됩니다.

## 실행 파일(.exe / .app) 만들기
파이썬을 직접 실행하지 않고 아이콘을 더블클릭해 실행하고 싶다면 PyInstaller 기반 패키징 스크립트를 사용하세요.

1. 추가 의존성을 설치합니다.
   ```bash
   pip install pyinstaller
   ```
2. Windows용 단일 실행 파일 생성
   ```bash
   python build_desktop.py --target windows
   ```
   - `dist/MOWInventory.exe`가 생성됩니다.
3. macOS용 앱 번들 생성
   ```bash
   python build_desktop.py --target mac
   ```
   - `dist/MOWInventoryMac.app` 폴더가 생성됩니다.
   - 하나의 바이너리로 묶고 싶다면 `--onefile` 옵션을 추가합니다.
4. 생성된 실행 파일/앱은 `dist/` 폴더에 위치합니다. macOS에서 보안 경고가 나오면 시스템 환경설정에서 “열기”를 승인하면 됩니다.

## macOS 실행 팁
- `dist/MOWInventoryMac.app`을 `응용 프로그램` 폴더로 옮긴 뒤 더블클릭하여 실행할 수 있습니다.
- 처음 실행 시 “알 수 없는 개발자” 경고가 나오면, **시스템 설정 → 개인정보 보호 및 보안**에서 “열기”를 허용하세요.

## 프로그램 창 디자인 변경 방법
모든 UI 스타일은 루트 디렉터리의 `theme.json`에 저장되어 있습니다. 원하는 디자인으로 쉽게 수정할 수 있습니다.

| 키 | 설명 | 예시 값 |
| --- | --- | --- |
| `font_family` | 전체 UI에서 사용할 글꼴 이름 | `"맑은 고딕"`, `"Apple SD Gothic Neo"` |
| `font_size` | 기본 글꼴 크기 | `11` |
| `background` | 메인 창 배경색 | `"#f4f5f7"` |
| `surface` | 카드/패널 배경색 | `"#ffffff"` |
| `accent` | 버튼·탭 선택 색 | `"#2563eb"` |
| `accent_text` | 강조 영역의 글자색 | `"#ffffff"` |
| `border_color` | 경계선 색상 | `"#d1d5db"` |
| `text_color` | 일반 텍스트 색상 | `"#111827"` |
| `tree_stripe` | 목록 행의 교차 배경색 | `"#f8fafc"` |

디자인 변경 절차:
1. `theme.json`을 텍스트 에디터로 열어 원하는 값을 수정합니다. (Hex 색상 또는 글꼴 이름 입력)
2. 파일을 저장한 뒤 애플리케이션을 재시작하면 즉시 새로운 디자인이 적용됩니다.
3. macOS에서 시스템 글꼴을 쓰고 싶다면 `font_family`를 `"Apple SD Gothic Neo"`, Windows에서는 `"맑은 고딕"`처럼 환경에 맞는 글꼴을 지정하세요.

## 그래프 분석 탭
- `그래프 분석` 탭은 최근 12개월의 **매출, 영업이익, 부가세, 소득세**를 세련된 라인 차트로 표시합니다.
- 색상은 `theme.json`과 연동되며, FigureCanvasTkAgg 기반으로 부드럽게 렌더링됩니다.
- 새 데이터를 입력하면 자동으로 갱신되며, 필요 시 `그래프 새로고침` 버튼으로 즉시 업데이트할 수 있습니다.

## 문서 동기화 사용법
프로그램은 실행과 동시에 `sync/` 폴더를 만들고 두 종류의 동기화 파일을 유지합니다.

| 파일 | 설명 |
| --- | --- |
| `sync/mow_sync.xlsx` | `products`, `sales`, `tax_settings` 시트로 구성된 엑셀 문서. 열 이름을 유지한 채 값을 수정하면 프로그램에서 그대로 반영할 수 있습니다. |
| `sync/mow_sync.tsv` | 동일한 내용을 테이블/JSON 구조로 저장한 TSV 문서. Excel이 없어도 텍스트 편집기로 수정해 동기화할 수 있습니다. |

1. **자동 저장**: 상품/판매/세금 데이터가 변경될 때마다 두 파일이 즉시 다시 생성됩니다.
2. **수동 저장**: `문서 동기화` 탭에서 “동기화 파일 수동 저장” 버튼으로 원하는 시점에 다시 내보낼 수 있습니다.
3. **엑셀에서 불러오기**: 편집한 엑셀 파일을 선택하면 DB 전체가 해당 내용으로 갱신됩니다(시트 이름과 열 이름 유지 필요).
4. **TSV에서 불러오기**: TSV 파일도 동일하게 불러올 수 있습니다. JSON 열을 수정할 때는 필수 키(`product_code`, `quantity` 등)를 삭제하지 마세요.

> ⚠️ 주의: 엑셀/TSV 파일을 크게 수정하면 기존 DB 데이터가 덮어써집니다. 필요한 경우 `백업` 탭에서 미리 DB를 백업해 두세요.

## 데이터 저장 및 백업
- 모든 데이터는 `data/mow.db`에 저장됩니다.
- **백업 탭**에서 원하는 위치로 `.db` 파일을 내보내거나, 기존 파일을 선택해 복원할 수 있습니다.
- `invoices/` 폴더에는 판매 시 자동으로 생성되는 CSV 세금계산서가 보관됩니다.
- `sync/` 폴더에는 엑셀·TSV 동기화 파일이 자동으로 생성되며 `.gitignore`에 포함되어 버전 관리에 영향을 주지 않습니다.

## 테스트
코드를 수정한 뒤에는 간단한 문법 검사를 실행해 주세요.
```bash
python -m py_compile inventory_app.py
```

